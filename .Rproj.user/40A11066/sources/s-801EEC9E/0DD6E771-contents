funcao = function(df, initial_quarter, final_quarter, initial_position,
                  final_position){
  
  df_aux = df %>%
    filter(year_quarter == initial_quarter &
             position == initial_position)
  
  
  initial_number = nrow(df_aux)
  
  initial_list = df_aux$id_code
  
  df_2 = df %>%
    filter(year_quarter == final_quarter &
             position == final_position)
  
  df_2 = df_2 %>%
    filter(id_code %in% initial_list)
  
  final_number = nrow(df_2)
  
  final_number/initial_number
}

####

cria_matriz_transicao = function(df, initial_quarter, final_quarter, n){
  
  matriz = matrix(nrow = n, ncol = n)
  
  for(i in 1:n){
    for(j in 1:n){
      
      matriz[i,j] = funcao(df = df,initial_quarter = initial_quarter,
                           final_quarter = final_quarter, initial_position = i,
                           final_position = j)
      
    }
  }
  
  matriz
}
