---
title: "Gabarito Lista Prática 1"
author: "Fredie Didier, Igor Rigolon"
date: "21/07/2021"
output: pdf_document
---

```{r setup, include=FALSE}
pasta <- "C:/Users/Fredie/Documents/GitHub/Monitoria_Econometria_I/2021.2/Listas Práticas/Lista Prática 1/dados"

knitr::opts_chunk$set(echo = TRUE)
knitr::opts_knit$set(root.dir = pasta)
```

1. 

Importando as bases de dados

```{r, message = FALSE, warning = FALSE}
educacao <- read.csv("./educacao.csv")
saneamento <- read.csv("./saneamento.csv")
pib <- read.csv("./pib_pc_munic.csv")
```

Histograma do tratamento de esgoto

```{r, message = FALSE, warning = FALSE}
library(ggplot2)

ggplot(saneamento, aes(x = indice_sem_atend)) +
  geom_histogram()
```

Vemos que a distribuição tem formato de U, o que significa que há muita concentração de cidades com pouquíssimo atendimento e, em contraste, muitas com atendimento quase perfeito.

b)

Fazer o merge por município ano e selecionar somente as colunas úteis:

```{r, message = FALSE, warning = FALSE}
library(dplyr)

data <- educacao %>%
  filter(ano == 2013 & rede == "municipal" & anos_escolares == "finais (6-9)") %>%
  inner_join(saneamento, by = "id_municipio") %>%
  inner_join(pib, by = "id_municipio") %>%
  select(id_municipio, indice_sem_atend, pib_pc_2013, ideb)
```

c)

Gráfico de dispersão

```{r, message = FALSE, warning = FALSE}
ggplot(data, aes(x = indice_sem_atend, y = ideb)) +
  geom_point()
```

Parece haver uma relação negativa que, apesar de fraca, indica que os municípios com menos atendimento de esgoto têm resultados piores no Ideb. Algumas possíveis explicações: Poderia haver uma relação direta entre as duas variáveis, de forma que a presença de saneamento aumenta a qualidade de vida dos alunos como um todo e, então eleva o desempenho escolar do município. A outra possibilidade, mais plausível de ter efeitos grandes, é que municípios com menos atendimento de esgoto tendem a ser mais pobres, ou terem maior carência de serviços públicos. Com isso, essa terceira variável explica o menor Ideb. 

2.

a)

```{r}
data <- educacao %>%
  filter(rede == "municipal" & anos_escolares == "finais (6-9)") %>%
  filter(sigla_uf == "MG") %>%
  left_join(saneamento, by = "id_municipio")

m <- mean(data$indice_sem_atend)

data <- data %>%
  mutate(esgoto = case_when(indice_sem_atend < m ~ 1,
                            indice_sem_atend >= m ~ 0))

data$esgoto <- as.factor(data$esgoto)

data <- data %>% 
  group_by(ano, esgoto) %>%
  summarise(ideb = mean(ideb, na.rm = TRUE))

ggplot(data, aes(x = ano, y = ideb, group = esgoto)) +
  geom_point() +
  geom_line()
```

b)

```{r}
data <- educacao %>%
  filter(ano == 2013 & rede == "municipal" & anos_escolares == "finais (6-9)") %>%
  inner_join(saneamento, by = "id_municipio") %>%
  inner_join(pib, by = "id_municipio") %>%
  select(id_municipio, indice_sem_atend, pib_pc_2013, ideb)

ggplot(data, aes(x = log(pib_pc_2013), y = indice_sem_atend)) +
  geom_point()
```
c)

```{r}
ggplot(data, aes(x = log(pib_pc_2013), y = ideb)) +
  geom_point()
```

